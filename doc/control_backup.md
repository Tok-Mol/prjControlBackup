# Приложение Система контроля хранения резервных копий (Control Backup)

**название**: _**Control Backup**_.

**дата**: _02.06.2022_

**версия**: _01.00.01_

---

## 1. Общая Задача

### 1.1. Исходные данные 

+ Cуществует `Система каталогов` формата:

```text
[root]
    +- [server1]                      <--------- Первый уровень
    |   +- [YYYY]                       <------+ 
    |       +- [MM]                            | Второй уровень
    |           +- [DD]                 <------+
    |               +- [File1.zip]          <--+
    |               |   ...                    | Третий уровень
    |               +- [FileN.zip]          <--+     
    +- [serverN]
        +- [YYYY]
            +- [MM]
                +- [DD]
                    +- [File1.zip]
                    |   ...
                    +- [FileN.zip]
```

+ На Первом уровне вложения находятся имена серверов `[serverN]`, где происходит сохранение файлов-архивов. Например: `ServerApp`, `ServerDb`, и т.д.;
+ На Втором уровне формируется иерархия папок из даты создания  файла-архива, включает последовательно папки: `ГОД`, `МЕСЯЦ`, `ДЕНЬ`. Синтаксис: `[YYYY]\[MM]\[DD]`, например: `2021\12\22`, `2021\12\23` и т.д.;
+ На Третьем уровне хранятся файлы-архивы с выбранного Сервера `[serverN]` в указанную дату `[YYYY]\[MM]\[DD]`. Например: `ServerApp\2021\12\23\file1.7z`;
+ Названия серверов на Первом уровне определенны и известны, но должна существовать возможность добавить или исключить из обработки один или несколько серверов;
+ Имена файлов-архивов на Третьем уровне определенны и известны, но должна существовать возможность добавить или исключить из обработки один или несколько имен файлов;
+ В `Систему каталогов` с неизвестной периодичностью, не контролируемой службой сохраняются файлы-архивы по необходимости формируя дополнительные каталоги всех уровней;
+ В процессе сохранения файлов-архивов возможны `Логические ошибки`:
  + не учтённый сервер на Первом уровне;
  + не учтённый файл-архив на Третьем уровне;
  + ошибка в формировании даты на Втором уровне;
  + сохранение любых файлов в любом месте в `Системе каталогов`;
  + создание каталогов на Втором уровне не отвечающих формату.

### 1.2. Необходимая функциональность

+ Контролировать создание `Системы каталогов`;
+ Фиксировать `Логические ошибки`;
+ Вести `Журнал регистрации` новых файлов-архивов;
+ Создавать `Ежедневный отчет` по состоянию `Системы каталогов` и файлов-архивов;
+ Хранить настройки программы в конфигурационном файле.

## 2. Описание функциональности версий

### 2.1. Версия 1.00.00

+ Настройки программы храним в конфигурационном файле `cfg_setting.py` в виде переменных;
+ Сканирование `Системы каталогов`, сортируя результат в списки `Работа` (для дальнейшей работы) и `Ошибки` (фиксации `Логических ошибок` в `Системе каталогов`).
+ Определять для каждого найденного файла:
  + имя, расширение;
  + размер;
  + дату создания;
+ Сохранять результаты поиска в файл-отчет.

### 2.2. Версия 1.00.01

В результате запуска приложения формируются четыре журнала с текущим содержимым Хранилища резервных копий с различным типом сортировки. 

Журналы:

+ Сервер (прямой):   сервер - дата(сортировка: старая->новая) - файл (имя, дата создания, размер);
+ Сервер (обратный): сервер - дата(сортировка: новая->старая) - файл (имя, дата создания, размер);
+ Дата (прямая):     дата(сортировка: старая->новая) - сервер - файл (имя, дата создания, размер),
+ Дата (обратная):   дата(сортировка: новая->старая) - сервер - файл (имя, дата создания, размер).

Путь к папке генерации журналов определен в переменной scr/pkt_config/cfg_setting.py->CFG_JRNL_PATH.

Шаблон имени файла-журнала определен в переменных:

- Сервер: scr/pkt_config/cfg_setting.py->CFG_JRNL_NAME_SERVER = 'journal_servers'
- Дата: scr/pkt_config/cfg_setting.py->CFG_JRNL_NAME_DATE = 'journal_date'


#### 2.2.1. Журнал серверы

Имя файла:

```text
Сервер (прямой)   > journal_servers_YYYY-MM-DD_YYYY-MM-DD.txt
Сервер (обратный) > journal_servers_YYYY-MM-DD_YYYY-MM-DD.txt
```

Пример имени файла-журнала:

```text
Сервер (прямой)   > journal_Servers_2020-01-04_2021-10-10.txt
Сервер (обратный) > journal_Servers_2021-10-10_2020-01-04.txt
```

Пример файла-журнала `Сервер (прямой) > journal_servers_2020-01-04_2021-10-10.txt`:

```text
CA1db
	2020.04.04
		usrlib.tar.gz       	2021-09-13 14:32	2766      	109       	
		www.tar.gz          	2021-09-13 14:32	2766      	110       	
	2021.07.16
		all.sql             	2021-09-13 14:32	2766      	296       	
		etc.tar.gz          	2021-09-13 14:32	2766      	297       	
	2021.10.10
		all.sql             	2022-01-29 14:00	41491     	401       	
		usrlib.tar.gz       	2022-01-29 14:00	2766      	404       	
		www.tar.gz          	2022-01-29 14:00	2766      	405       	
CA2db
	2020.04.04
		usrlib.tar.gz       	2021-09-13 14:32	2766      	109       	
		www.tar.gz          	2021-09-13 14:32	2766      	110       	
	2021.07.16
		all.sql             	2021-09-13 14:32	2766      	296       	
		etc.tar.gz          	2021-09-13 14:32	2766      	297       	
	2021.10.10
		all.sql             	2022-01-29 14:00	41491     	401       	
		usrlib.tar.gz       	2022-01-29 14:00	2766      	404       	
		www.tar.gz          	2022-01-29 14:00	2766      	405       	
```

Пример файла-журнала `Сервер (обратный) > journal_servers_2021-10-10_2020-01-04.txt`:

```text
CA1db
	2021.10.10
		usrlib.tar.gz       	2021-09-13 14:32	2766      	109       	
		www.tar.gz          	2021-09-13 14:32	2766      	110       	
	2021.07.16
		all.sql             	2021-09-13 14:32	2766      	296       	
		etc.tar.gz          	2021-09-13 14:32	2766      	297       	
	2020.04.04
		all.sql             	2022-01-29 14:00	41491     	401       	
		usrlib.tar.gz       	2022-01-29 14:00	2766      	404       	
		www.tar.gz          	2022-01-29 14:00	2766      	405       	
CA2db
	2021.10.10
		usrlib.tar.gz       	2021-09-13 14:32	2766      	109       	
		www.tar.gz          	2021-09-13 14:32	2766      	110       	
	2021.07.16
		all.sql             	2021-09-13 14:32	2766      	296       	
		etc.tar.gz          	2021-09-13 14:32	2766      	297       	
	2020.04.04
		all.sql             	2022-01-29 14:00	41491     	401       	
		usrlib.tar.gz       	2022-01-29 14:00	2766      	404       	
		www.tar.gz          	2022-01-29 14:00	2766      	405       	
```

#### 2.2.2. Журнал даты

Синтаксис имени файла-журнала:

```text
Дата (прямая)   > journal_date_YYYY-MM-DD_YYYY-MM-DD.txt
Дата (обратная) > journal_date_YYYY-MM-DD_YYYY-MM-DD.txt
```

Пример имени файла-журнала:

```text
journal_date_2020-01-04_2021-10-10.txt
journal_date_2021-10-10_2020-01-04.txt
```

Пример файла-журнала `Дата (прямая) > journal_date_2020-01-04_2021-10-10.txt`:

```text
2020.01.04
	DSid1db
		all.sql             	2021-09-13 14:32	2766      	486       	
		usrlib.tar.gz       	2021-09-13 14:32	2766      	489       	
		www.tar.gz          	2021-09-13 14:32	2766      	490       	
	DSid2db
		all.sql             	2021-09-13 14:32	2766      	796       	
		etc.tar.gz          	2021-09-13 14:32	2766      	797       	
	DV1db
		all.sql             	2021-09-13 14:32	2766      	1021      	
		www.tar.gz          	2021-09-13 14:32	2766      	1025      	
2020.01.07
	DSid1db
		all.sql             	2021-09-13 14:32	2766      	491       	
		etc.tar.gz          	2021-09-13 14:32	2766      	492       	
	IAid1db
		all.sql             	2021-09-13 14:32	2766      	1869      	
		www.tar.gz          	2021-09-13 14:32	2766      	1873      	
2021.10.10
	DSid1db
		all.sql             	2021-09-13 14:32	2766      	496       	
		usrlib.tar.gz       	2021-09-13 14:32	2766      	499       	
		www.tar.gz          	2021-09-13 14:32	2766      	500       	
	IAid1db
		all.sql             	2021-09-13 14:32	2766      	1874      	
		www.tar.gz          	2021-09-13 14:32	2766      	1878      	
```

Пример файла-журнала `Дата (обратная) > journal_date_2021-10-10_2020-01-04.txt`:

```text
2021.10.10
	DSid1db
		all.sql             	2021-09-13 14:32	2766      	486       	
		usrlib.tar.gz       	2021-09-13 14:32	2766      	489       	
		www.tar.gz          	2021-09-13 14:32	2766      	490       	
	DSid2db
		all.sql             	2021-09-13 14:32	2766      	796       	
		etc.tar.gz          	2021-09-13 14:32	2766      	797       	
	DV1db
		all.sql             	2021-09-13 14:32	2766      	1021      	
		www.tar.gz          	2021-09-13 14:32	2766      	1025      	
2020.01.07
	DSid1db
		all.sql             	2021-09-13 14:32	2766      	491       	
		etc.tar.gz          	2021-09-13 14:32	2766      	492       	
	IAid1db
		all.sql             	2021-09-13 14:32	2766      	1869      	
		www.tar.gz          	2021-09-13 14:32	2766      	1873      	
2020.01.04
	DSid1db
		all.sql             	2021-09-13 14:32	2766      	496       	
		usrlib.tar.gz       	2021-09-13 14:32	2766      	499       	
		www.tar.gz          	2021-09-13 14:32	2766      	500       	
	IAid1db
		all.sql             	2021-09-13 14:32	2766      	1874      	
		www.tar.gz          	2021-09-13 14:32	2766      	1878      	
```



## 3. Дополнительная информация

- [PyCharm+Git+GitHub, Работа с Git в PyCharm. Без терминалов и головной боли.](https://youtu.be/9VKKZNqzPcE)
- [PyCharm+Git+GitHub, Работа с git на реальном проекте, используя PyCharm.](https://youtu.be/hqDWXBlQG5c)
- [PyCharm+Unittest, Юнит-тестирование. Использование unittest и coverage в PyCharm](https://youtu.be/YD7aYJh3k-w)

## 4. То без чего никуда...

- [m1](https://youtu.be/sU4ypQpZQys)